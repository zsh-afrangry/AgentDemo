# 🧠 任务清单
## ✅ 阶段1：数据库分析（Schema Learner）

- [ ] 解析各部门数据库结构（SBDB / MTDB / TAXDB / CABDB）
  - [ ] schema_parser.py - 抽取表名、字段、类型、注释
  - [ ] schema_understanding.py - 生成字段语义与表关联
  - [ ] 保存 Schema JSON 至 `/data/schema_json/`
- [ ] 优化 Schema 缓存与读取效率
  - [ ] file_io.py - JSON 转 cache.pkl 缓存机制
  - [ ] 增加重复表检测逻辑

---

## ✅ 阶段2：问题库生成（Problem Bank Generator）

- [ ] 读取规则样例文件 human_rules.txt
- [ ] 抽取状态矛盾 / 资格冲突 / 聚合异常三类模式
- [ ] 生成问题模板 problem_templates.py
- [ ] 输出 generated_problems.json
- [ ] 增加问题模板版本控制与自动更新机制

---

## 🔄 阶段3：任务识别与数据聚类（Task-driven Data Clustering）

- [ ] 自然语言任务识别
  - [ ] clustering.py - 使用LLM识别任务类型
  - [ ] 输出 task_type.json
- [ ] 语义聚类表与字段
  - [ ] 调用 schema_understanding.py 聚类字段
  - [ ] 输出 task_related_tables.json
- [ ] 构建任务视图
  - [ ] db_connection.py - 提取相关数据
  - [ ] 输出 task_data_view.json

---

## 🧩 阶段4：Text-to-SQL 转换模块

### (1) 提示词优化模块（Prompt Optimization）

- [ ] prompt_rewriter.py - 将中文自然语言转为SQL友好提示
- [ ] 输出 rewritten_prompt.txt
- [ ] feedback.py - 收集成功提示样本
- [ ] 输出 prompt_refine_dataset.json

### (2) SQL生成与修正模块（Text-to-SQL + Auto Debugger）

- [ ] sql_generator.py - 根据提示生成SQL语句
- [ ] 输出 generated.sql
- [ ] sql_validator.py - 执行SQL验证与错误捕获
- [ ] debugger.py - 自动修复错误SQL
- [ ] 输出 valid_sql.sql
- [ ] 记录日志 analysis_log.txt

---

## 📊 阶段5：结果整合与可视化展示

- [ ] report_builder.py - 汇总违规结果
- [ ] 输出 conflict_report.json
- [ ] visualizer.py - 提供 REST API 接口
- [ ] 前端展示
  - [ ] ResultView.vue - 展示违规结果表格
  - [ ] Dashboard.vue - 展示图表统计
- [ ] 输出：违规报告与图形化结果

---

## ♻️ 阶段6：持续学习与自我优化

- [ ] feedback.py - 收集人工核查标注反馈
- [ ] self_refine_dataset.json - 整理训练样本
- [ ] retrain_dataset.json - 形成可微调数据集
- [ ] 优化提示词与SQL生成模型

---

## 🧩 支撑模块

- [ ] db_connection.py - 多数据库连接管理
- [ ] file_io.py - 统一文件读写接口
- [ ] logger.py - 运行日志记录模块
- [ ] config_loader.py - 环境配置加载
- [ ] settings.json - 环境参数文件
- [ ] agents_config.json - 智能体启用策略配置

---

## 📘 文档任务

- [ ] 模块设计说明.md - 各模块输入输出与依赖关系
- [ ] 数据库说明.md - 各数据库表结构
- [ ] API接口文档.md - 后端接口定义
- [ ] 测试数据设计.md - 各类测试数据生成方案

---

🕹️ **任务优先顺序**
1️⃣ 阶段3 任务识别与数据聚类  
2️⃣ 阶段4 Text-to-SQL 模块  
3️⃣ 阶段5 可视化展示  
4️⃣ 阶段6 持续学习循环
