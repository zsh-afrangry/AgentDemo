# æ¨¡å—è¯´æ˜

> æœ¬æ–‡æ¡£æè¿°å„æ¨¡å—çš„è¾“å…¥ã€è¾“å‡ºã€ä¾èµ–ä¸è°ƒç”¨å…³ç³»ã€‚
> ç³»ç»Ÿä¸»çº¿ï¼šSchema ç†è§£ â†’ é—®é¢˜åº“ç”Ÿæˆ â†’ ä»»åŠ¡è¯†åˆ« â†’ Text-to-SQL â†’ å¯è§†åŒ– â†’ å­¦ä¹ ä¼˜åŒ–

---

## ğŸ§© 1. Schema Parser æ¨¡å—ï¼ˆschema_parser.pyï¼‰

**åŠŸèƒ½**  
ä»å¤šä¸ªæ•°æ®åº“ä¸­è§£æè¡¨ç»“æ„ã€å­—æ®µã€æ³¨é‡Šï¼Œè¾“å‡ºç»Ÿä¸€çš„ Schema JSONã€‚

**è¾“å…¥**
- MySQL / PostgreSQL æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ˆæ¥è‡ª config/settings.jsonï¼‰

**è¾“å‡º**
- `/data/schema_json/{DB_NAME}_schema.json`

**ä¾èµ–**
- `db_connection.py`ï¼šæ‰§è¡Œä¿¡æ¯æå–
- `file_io.py`ï¼šä¿å­˜JSON

**è°ƒç”¨**
- è¢« `schema_understanding.py` è°ƒç”¨ï¼Œç”Ÿæˆè¯­ä¹‰å›¾è°±ã€‚

---

## ğŸ§  2. Schema Understanding æ¨¡å—ï¼ˆschema_understanding.pyï¼‰

**åŠŸèƒ½**  
åŸºäºSchemaç»“æ„ç”Ÿæˆâ€œå­—æ®µè¯­ä¹‰+è¡¨é—´å…³ç³»â€è®¤çŸ¥å›¾è°±ã€‚

**è¾“å…¥**
- å„æ•°æ®åº“ schema JSON

**è¾“å‡º**
- `schema_graph.json`ï¼ˆå­—æ®µè¯­ä¹‰ã€å…³è”å…³ç³»ï¼‰

**ä¾èµ–**
- `schema_parser.py`
- `logger.py`

**è°ƒç”¨**
- è¢« `problem_generator.py` å’Œ `clustering.py` è°ƒç”¨

---

## ğŸ§© 3. Problem Generator æ¨¡å—ï¼ˆproblem_generator.pyï¼‰

**åŠŸèƒ½**  
åŸºäºè§„åˆ™æ ·ä¾‹å’ŒSchemaå›¾è°±ç”Ÿæˆé¢„è®¾é—®é¢˜åº“ã€‚

**è¾“å…¥**
- `schema_graph.json`
- `human_rules.txt`

**è¾“å‡º**
- `generated_problems.json`

**ä¾èµ–**
- `schema_understanding.py`
- `problem_templates.py`
- `file_io.py`

**è°ƒç”¨**
- åç«¯API `/generate_problems`
- è¢« Text-to-SQL æ¨¡å—è¯»å–ä»¥ç†è§£å†²çªé€»è¾‘

---

## ğŸ” 4. Clustering æ¨¡å—ï¼ˆclustering.pyï¼‰

**åŠŸèƒ½**  
è¯†åˆ«ç”¨æˆ·ä»»åŠ¡ç±»å‹ï¼ˆå¯¹è´¦/ç¨½æ ¸/èµ„æ ¼æ£€æµ‹ï¼‰å¹¶èšç±»ç›¸å…³è¡¨ä¸å­—æ®µã€‚

**è¾“å…¥**
- ç”¨æˆ·è‡ªç„¶è¯­è¨€è¯·æ±‚
- `schema_graph.json`

**è¾“å‡º**
- `task_type.json`
- `task_related_tables.json`
- `task_data_view.json`

**ä¾èµ–**
- `schema_understanding.py`
- LLM æ¨¡å‹ï¼ˆä»»åŠ¡åˆ†ç±»ï¼‰

**è°ƒç”¨**
- æä¾›ä¸Šä¸‹æ–‡ç»™ Text-to-SQL æ¨¡å—

---

## ğŸ§  5. Prompt Rewriter æ¨¡å—ï¼ˆprompt_rewriter.pyï¼‰

**åŠŸèƒ½**  
å°†ä¸­æ–‡è‡ªç„¶è¯­è¨€è¯·æ±‚æ”¹å†™ä¸ºLLMå¯ç†è§£çš„SQLç”Ÿæˆæç¤ºã€‚

**è¾“å…¥**
- ç”¨æˆ·åŸå§‹éœ€æ±‚ï¼ˆä¸­æ–‡ï¼‰

**è¾“å‡º**
- `rewritten_prompt.txt`

**ä¾èµ–**
- å†å²æˆåŠŸæ ·æœ¬ `prompt_refine_dataset.json`
- æ¨¡å‹ï¼ˆQwen / Claude / LLaMAï¼‰

**è°ƒç”¨**
- `sql_generator.py`

---

## ğŸ§® 6. SQL Generator æ¨¡å—ï¼ˆsql_generator.pyï¼‰

**åŠŸèƒ½**  
æ ¹æ®æç¤ºç”ŸæˆSQLè¯­å¥ã€‚

**è¾“å…¥**
- `rewritten_prompt.txt`

**è¾“å‡º**
- `generated.sql`

**ä¾èµ–**
- æ¨¡å‹API (dashscope / OpenAI / Ollama)
- `logger.py`

**è°ƒç”¨**
- `sql_validator.py` æ‰§è¡ŒéªŒè¯

---

## ğŸ§° 7. SQL Validator / Debugger æ¨¡å—ï¼ˆsql_validator.py + debugger.pyï¼‰

**åŠŸèƒ½**  
éªŒè¯SQLå¯æ‰§è¡Œæ€§ï¼Œæ•è·é”™è¯¯å¹¶è‡ªåŠ¨ä¿®å¤ã€‚

**è¾“å…¥**
- `generated.sql`

**è¾“å‡º**
- `valid_sql.sql`
- `analysis_log.txt`

**ä¾èµ–**
- `db_connection.py`
- `logger.py`

**è°ƒç”¨**
- è¿”å›ä¿®æ­£SQLä¾›æŠ¥å‘Šç”Ÿæˆæ¨¡å—ä½¿ç”¨

---

## ğŸ“Š 8. Report Builder æ¨¡å—ï¼ˆreport_builder.pyï¼‰

**åŠŸèƒ½**  
æ•´åˆæ‰€æœ‰æ™ºèƒ½ä½“æ£€æµ‹ç»“æœç”Ÿæˆæœ€ç»ˆè¿è§„æŠ¥å‘Šã€‚

**è¾“å…¥**
- å„Agentç»“æœï¼ˆbinary / process / quantitativeç­‰ï¼‰

**è¾“å‡º**
- `conflict_report.json`

**ä¾èµ–**
- å„å­æ¨¡å—æ‰§è¡Œç»“æœ
- `file_io.py`

**è°ƒç”¨**
- `visualizer.py` å’Œå‰ç«¯API

---

## ğŸŒ 9. Visualizer æ¨¡å—ï¼ˆvisualizer.pyï¼‰

**åŠŸèƒ½**  
ä¸ºå‰ç«¯æä¾›è¿è§„ç»“æœæ¥å£ä¸å¯è§†åŒ–æ•°æ®ã€‚

**è¾“å…¥**
- `conflict_report.json`

**è¾“å‡º**
- REST API å“åº” JSON

**ä¾èµ–**
- `FastAPI`
- `report_builder.py`

**è°ƒç”¨**
- å‰ç«¯ `ResultView.vue` / `Dashboard.vue`

---

## ğŸ” 10. Feedback æ¨¡å—ï¼ˆfeedback.pyï¼‰

**åŠŸèƒ½**  
æ”¶é›†äººå·¥æ ‡æ³¨åé¦ˆï¼ŒæŒç»­ä¼˜åŒ–æ¨¡å‹ã€‚

**è¾“å…¥**
- ç”¨æˆ·åé¦ˆç»“æœ
- è¿è§„åˆ¤å®šä¿®æ­£æ•°æ®

**è¾“å‡º**
- `feedback.json`
- `self_refine_dataset.json`

**ä¾èµ–**
- æ‰€æœ‰ä¸Šæ¸¸æ¨¡å—çš„è¾“å‡º
- `file_io.py`

**è°ƒç”¨**
- æŒç»­å­¦ä¹ æœºåˆ¶å…¥å£

---

## ğŸ”§ 11. æ”¯æ’‘æ¨¡å—

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| æ•°æ®åº“è¿æ¥ | db_connection.py | å¤šåº“è¿æ¥æ± ç®¡ç† |
| æ–‡ä»¶è¯»å†™ | file_io.py | JSON/TXT æ–‡ä»¶ç®¡ç† |
| æ—¥å¿—ç³»ç»Ÿ | logger.py | æ¨¡å—è¿è¡Œæ—¥å¿— |
| é…ç½®ç®¡ç† | config_loader.py / settings.json | ç¯å¢ƒä¸è·¯å¾„å‚æ•° |
| æ™ºèƒ½ä½“é…ç½® | agents_config.json | æ§åˆ¶å¯ç”¨å“ªäº›Agent |

---

## ğŸ“ˆ æ¨¡å—è°ƒç”¨å…³ç³»ç®€å›¾

